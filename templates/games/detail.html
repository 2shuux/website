{% extends "base.html" %}
{% load thumbnail %}


{% block content %}
  <div class="game-header">
    <div class='title'>
      {% if game.icon %}
        <img src='{{ MEDIA_URL }}{{ game.icon }}' width='128' height='128' />
      {% endif %}
      <span>{{ game.name }}</span>
    </div>
  </div>

  <div class="row">
    <div class="col-md-9">
      {% with game.screenshot_set.published as screenshots %}
        <div class="carousel slide">
          {% if screenshots %}
            <div class='screenshots carousel-inner'>
              {% for screenshot in game.screenshot_set.published %}
                {% thumbnail screenshot.image '640x480' crop="center" as img %}
                  <img src="{{ MEDIA_URL }}/{{ img }}" title="{{ screenshot.description }}" />
                {% endthumbnail %}
              {% endfor %}
            </div>
          {% endif %}
          <a href='{% url 'screenshot_add' game.slug %}' class='btn btn-mini pull-right'>Submit screenshot</a>
        </div>
      {% endwith %}
      <article>
        {{ game.description|linebreaks }}
      </article>
      <div class="installer-list">
        <ul>
          {% for installer in installers %}
            <li>
              <span class='filter-link'>{{ installer.runner }}</span>
              <span class='installer-name'>{{ installer.slug }}</span>
              <div class="right">
                {% if installer.user == user %}
                  {% url 'edit_installer' slug=installer.slug as edit_url %}
                  <a href="{{ edit_url }}" class="btn btn-mini"><i class="icon-edit"></i> Edit installer </a>
                {% endif %}

                {% url 'serve_installer' slug=installer.slug as download_url %}
                <a href="{{ download_url }}" class="btn btn-mini"><i class="icon-download"></i> Download</a>

                <a href='lutris:{{ installer.slug }}' class="btn"><i class="icon-download-alt"></i> Install</a>
              </div>
              <p>
                {% if installer.description %}
                  {{ installer.description }}
                  <br />
                {% endif %}
                Submitted by {{ installer.user.username }}
              </p>
            </li>
          {% endfor %}
        </ul>
        <a href="{% url "new_installer" slug=game.slug %}" class="btn btn-small btn-inverse">Write a new installer</a>
      </div>
    </div>
    <div class="col-md-3">
      <div class="game-info">
        {% thumbnail game.title_logo "184" as img %}
          <img src="{{ img.url }}" class="banner" />
        {% endthumbnail %}

        <ul>
          <li>
            <strong>Genre: </strong>
            {% for genre in game.genres.all %}
              {{ genre }}{% if not forloop.last %}, {% endif %}
            {% endfor %}
          </li>
          <li>
            <strong>Platform: </strong>
            {% for platform in game.platforms.all %}
              {{ platform }}{% if not forloop.last %}, {% endif %}
            {% endfor %}
          </li>
          {% if game.developer %}
          <li>
            <strong>Developer: </strong>
            <a href="{{ game.developer.get_absolute_url }}">{{ game.developer }}</a>
          </li>
          {% endif %}
          {% if game.publisher %}
          <li>
            <strong>Publisher: </strong>
            <a href="{{ game.publisher.get_absolute_url }}">{{ game.publisher }}</a>
          </li>
          {% endif %}
          <li>
            <strong>Release date: </strong>
            {% firstof game.year "Unknown" %}
          </li>
          {% if game.website %}
          <li>
              <strong>Website: </strong>
              <a href='{{ game.website }}'>{{ game.website }}</a>
          </li>
          {% endif %}
        </ul>
        <div class="centered">
          {% if game.steamid %}
          <a href="http://store.steampowered.com/app/{{ game.steamid }}/" class="box-link">
            <img src="{{ STATIC_URL }}images/steam.png" alt="" />
            Get it on Steam
          </a>
          {% endif %}
          {% if not in_library %}
            <a href="{% url "add_to_library" slug=game.slug %}" class="btn">Add to my library</a>
          {% else %}
            <p>
            {{ game }} is in your library
            </p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}
